t60.

:- dynamic location/1.
:- dynamic equipment/1.
:- dynamic evacuated/1.
:- dynamic responded/1.
:- dynamic suggestion/1. 
:- dynamic risk_level/1.

alarmE(E, L) :> 
    assert(location(L)), 
    
    acquire_knowledge(E), 
    
    check_ai_suggestion(E),
    
    evacuateA(E, L), 
    equipA(E).

check_ai_suggestion(_) :-
    suggestion(Action),
    write('!!! AI HINT: '), write(Action), nl.

check_ai_suggestion(_) :-
    write('... Nessun suggerimento specifico trovato in memoria.'), nl.

equippedE(E) :> assert(equipment(E)).
evacuatedE(L):> assert(evacuated(L)).
respondedE(L):> assert(responded(L)).

response(E, L) :- location(_), location(L), equipment(_), equipment(E).
responseI(E, L) :> messageA(responder, send_message(respond(E, L), Me)), retract(location(_)), retract(equipment(_)).

done(L) :- evacuated(_), evacuated(L), responded(_), responded(E).
doneI(L) :> logA(message(coordinator, done)), retract(evacuated(_)), retract(responded(_)).

equipA(E):> messageA(manager, send_message(emergency(E), Me)).

evacuateA(E, L):> messageA(communicator,inform(communicate([mary, john], E, communicator), communicator)), messageA(evacuator, send_message(evacuate(L), Me)).

logA(X) :> messageA(logger, send_message(X, Me)).